# stage4_jogsarar.yaml
stage4:
  # I/O
  in_raw_segy_root: /home/dcuser/data/ActiveSeisField/jogsarar/infer_only2
  in_win512_segy_root: /home/dcuser/data/ActiveSeisField/jogsarar/infer_out/iter00/stage2_win512
  out_pred_root: /home/dcuser/data/ActiveSeisField/jogsarar/infer_out/iter00/stage4_pred
  segy_exts: [".sgy", ".segy"]

  # model resolve (YAML mode)
  cfg_yaml: /workspace/proc/jogsarar/configs/config_convnext_prestage2_drop005.yaml
  ckpt_path: null
  standardize_eps: 1.0e-8
  device: cuda
  p_class_index: 0

  # win512 -> raw inverse mapping
  up_factor: 2.0

  # tiled inference
  tile_h: 128
  tile_w: 512
  overlap_h: 96
  overlap_w: 0
  tiles_per_batch: 8
  use_amp: true
  use_tqdm: false

  # residual statics
  rs_pre: 20
  rs_post: 20
  rs_max_lag: 4
  rs_k_neighbors: 5
  rs_n_iter: 1
  rs_mode: diff
  rs_c_th: 0.8
  rs_smooth_method: wls
  rs_lam: 5.0
  rs_subsample: true
  rs_propagate_low_corr: false
  rs_taper: hann
  rs_taper_power: 1.0
  rs_lag_penalty: 0.10
  rs_lag_penalty_power: 1.0

  # final snap
  snap_mode: trough
  snap_ltcor: 2
  log_gather_rs: true

  # post-trough refinement
  post_trough_max_shift: 0
  post_trough_scan_ahead: 0
  post_trough_peak_search: before_pick   # after_pick | before_pick
  post_trough_smooth_win: 5
  post_trough_offs_abs_min_m: null
  post_trough_offs_abs_max_m: null
  post_trough_a_th: 0.03
  post_trough_align_zero_pin_tol: 5
  # align shifts to neighborhood
  post_trough_outlier_radius: 3
  post_trough_outlier_min_support: 3
  post_trough_outlier_max_dev: 2
  post_trough_align_propagate_zero: True

  # debug
  post_trough_debug: false
  post_trough_debug_max_examples: 5
  post_trough_debug_every_n_gathers: 10

  # misc
  dt_tol_sec: 1.0e-9
  min_gather_h: 32
  edge_pick_max_gap_samples: 5

  # viz
  viz_every_n_shots: 100
  viz_dirname: viz
  viz_plot_start: 0
  viz_plot_end: 1000
  viz_figsize: [12, 9]
  viz_dpi: 200
  viz_gain: 2.0
